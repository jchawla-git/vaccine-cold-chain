



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.1">
    
    
      
        <title>Develop the simulation app - Vaccine Cold Chain Monitoring</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../extra.css">
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#the-simulator-as-web-app" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Vaccine Cold Chain Monitoring" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Vaccine Cold Chain Monitoring
            </span>
            <span class="md-header-nav__topic">
              Develop the simulation app
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/ibm-cloud-architecture/vaccine-cold-chain.git/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Vaccine Cold Chain Monitoring" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Vaccine Cold Chain Monitoring
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/ibm-cloud-architecture/vaccine-cold-chain.git/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Introduction
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Introduction
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="What you will learn" class="md-nav__link">
      What you will learn
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Environments
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Environments
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../environments/event-streams/" title="Event Streams environment" class="md-nav__link">
      Event Streams environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../environments/mongo/" title="MongoDB on IBM Cloud" class="md-nav__link">
      MongoDB on IBM Cloud
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../environments/postgresql/" title="Postgresql on IBM Cloud" class="md-nav__link">
      Postgresql on IBM Cloud
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../environments/cp4d/" title="Cloud Pak for Data" class="md-nav__link">
      Cloud Pak for Data
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      AI Ladder
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        AI Ladder
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1">
    
    <label class="md-nav__link" for="nav-3-1">
      Collect
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        Collect
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-1-1" type="checkbox" id="nav-3-1-1">
    
    <label class="md-nav__link" for="nav-3-1-1">
      Preparing data for demonstration
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-1-1">
        Preparing data for demonstration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../collect/generate-telemetry/" title="Generate telemetry data" class="md-nav__link">
      Generate telemetry data
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../collect/cp4i-es/" title="Data ingestion and in motion with Cloud Pak for Integration" class="md-nav__link">
      Data ingestion and in motion with Cloud Pak for Integration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../collect/cp4d-collect-data/" title="Collect data with Cloud Pak for Data" class="md-nav__link">
      Collect data with Cloud Pak for Data
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-2" type="checkbox" id="nav-3-2">
    
    <label class="md-nav__link" for="nav-3-2">
      Analyze
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-2">
        Analyze
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../analyze/ws-ml-dev/" title="Define the anomaly detection scoring model with Watson Studio" class="md-nav__link">
      Define the anomaly detection scoring model with Watson Studio
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-3" type="checkbox" id="nav-3-3">
    
    <label class="md-nav__link" for="nav-3-3">
      Infuse
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-3">
        Infuse
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Develop the simulation app
      </label>
    
    <a href="./" title="Develop the simulation app" class="md-nav__link md-nav__link--active">
      Develop the simulation app
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements-job-stories" title="Requirements: Job Stories" class="md-nav__link">
    Requirements: Job Stories
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#design-approach" title="Design approach" class="md-nav__link">
    Design approach
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-approach" title="Code approach" class="md-nav__link">
    Code approach
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unit-test-the-simulator" title="Unit test the Simulator" class="md-nav__link">
    Unit test the Simulator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#functional-testing" title="Functional testing" class="md-nav__link">
    Functional testing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-for-kubernetes-deployment" title="Prepare for kubernetes deployment" class="md-nav__link">
    Prepare for kubernetes deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build" title="Build" class="md-nav__link">
    Build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-deployment" title="Application deployment" class="md-nav__link">
    Application deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#continuous-deployment-with-tekton" title="Continuous deployment with Tekton" class="md-nav__link">
    Continuous deployment with Tekton
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" title="Usage" class="md-nav__link">
    Usage
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#to-generate-data-at-rest" title="To generate data at rest" class="md-nav__link">
    To generate data at rest
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-readings" title="More readings" class="md-nav__link">
    More readings
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dev-scoring/" title="Develop scoring app with cloud pak for application" class="md-nav__link">
      Develop scoring app with cloud pak for application
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../build-run/" title="Build and run the solution on Openshift" class="md-nav__link">
      Build and run the solution on Openshift
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../integration-tests/" title="Run integration tests" class="md-nav__link">
      Run integration tests
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bpm/readme/" title="Engineer dispatching with Business process with Cloud Pak for Automation" class="md-nav__link">
      Engineer dispatching with Business process with Cloud Pak for Automation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Devops
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Devops
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Develop the simulation app
      </label>
    
    <a href="./" title="Develop the simulation app" class="md-nav__link md-nav__link--active">
      Develop the simulation app
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements-job-stories" title="Requirements: Job Stories" class="md-nav__link">
    Requirements: Job Stories
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#design-approach" title="Design approach" class="md-nav__link">
    Design approach
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-approach" title="Code approach" class="md-nav__link">
    Code approach
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unit-test-the-simulator" title="Unit test the Simulator" class="md-nav__link">
    Unit test the Simulator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#functional-testing" title="Functional testing" class="md-nav__link">
    Functional testing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-for-kubernetes-deployment" title="Prepare for kubernetes deployment" class="md-nav__link">
    Prepare for kubernetes deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build" title="Build" class="md-nav__link">
    Build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-deployment" title="Application deployment" class="md-nav__link">
    Application deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#continuous-deployment-with-tekton" title="Continuous deployment with Tekton" class="md-nav__link">
    Continuous deployment with Tekton
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" title="Usage" class="md-nav__link">
    Usage
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#to-generate-data-at-rest" title="To generate data at rest" class="md-nav__link">
    To generate data at rest
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-readings" title="More readings" class="md-nav__link">
    More readings
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dev-scoring/" title="Develop the scoring app with event messaging and microprofile" class="md-nav__link">
      Develop the scoring app with event messaging and microprofile
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/ci/" title="Continuous Integration" class="md-nav__link">
      Continuous Integration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../devops/cd/" title="Continuous Deployment" class="md-nav__link">
      Continuous Deployment
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../bpm/readme/" title="Engineer dispatching with Business process with Cloud Pak for Automation" class="md-nav__link">
      Engineer dispatching with Business process with Cloud Pak for Automation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../compendium/" title="Compendium" class="md-nav__link">
      Compendium
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements-job-stories" title="Requirements: Job Stories" class="md-nav__link">
    Requirements: Job Stories
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#design-approach" title="Design approach" class="md-nav__link">
    Design approach
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-approach" title="Code approach" class="md-nav__link">
    Code approach
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unit-test-the-simulator" title="Unit test the Simulator" class="md-nav__link">
    Unit test the Simulator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#functional-testing" title="Functional testing" class="md-nav__link">
    Functional testing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prepare-for-kubernetes-deployment" title="Prepare for kubernetes deployment" class="md-nav__link">
    Prepare for kubernetes deployment
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build" title="Build" class="md-nav__link">
    Build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-deployment" title="Application deployment" class="md-nav__link">
    Application deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#continuous-deployment-with-tekton" title="Continuous deployment with Tekton" class="md-nav__link">
    Continuous deployment with Tekton
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" title="Usage" class="md-nav__link">
    Usage
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#to-generate-data-at-rest" title="To generate data at rest" class="md-nav__link">
    To generate data at rest
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#more-readings" title="More readings" class="md-nav__link">
    More readings
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ibm-cloud-architecture/vaccine-cold-chain.git/edit/master/docs/infuse/simul-app.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="the-simulator-as-web-app">The Simulator as web app</h1>
<p>The Simulator webapp is a simple python (3.7) Flask web app exposing a REST POST end point to control the type of simulation to run and to produce Reefer telemetry events to kafka <code>reefer-telemetry</code> topic.</p>
<div class="admonition what_to_learn">
<p class="admonition-title">What_to_learn</p>
<p>In this article we shortly present the design and implementation approaches used for this application, as well as how to use <a href="https://appsody.dev">Appsody</a> to jumpstart the implementation, and continously run and debug the application. We are presenting some best practice on TDD with python.</p>
</div>
<h2 id="requirements-job-stories">Requirements: Job Stories</h2>
<p>The simulator is not in the critical path for production like component. It is here to help us develop the other components of the solution as we do not have real life Reefer container. To try something different, we are not using user stories to present what the simulator should do but we are using <a href="https://jtbd.info/replacing-the-user-story-with-the-job-story-af7cdee10c27">job stories</a>.</p>
<ol>
<li>when I want to generate mockup telemetries data for my data scientist friend, I want to start the simulator tool from command line so I can get a csv file with data</li>
<li>when I want to generate mockup telemetries data for my data scientist friend, I want to be able to simulate co2 sensor, o2 sensor and power sensor issue so I can get relevant data for the machine learning model to make sense</li>
<li>when I want to generate mockup telemetries data for my data scientist friend, I want to start the simulator tool from command line using parameter so I can get save data to a remote document oriented database: mongodb on IBM cloud.</li>
<li>when I want to demonstrate the solution, I want to call a REST api to control the generation of faulty sensor data so I can get the scoring service returning maintenance needed.</li>
</ol>
<p>The simulator needs to integrate with kafka / event stream deployed as service on the cloud or on-premise on openshift.</p>
<h2 id="design-approach">Design approach</h2>
<p>To support remote control of the simulator while running as webapp, we define a POST operation on the <code>/control</code> URL:</p>
<p><img alt="" src="../images/simulapp-control-swagger.png" /></p>
<p>with a json control object to define the number records to simulate, the sensor to impact (co2sensor, o2sensor, power) , the container ID, (one of C01, C02, C03, C04) which carries the product referenced by product_id (one of P01, P02, P03, P04, P05):</p>
<div class="codehilite"><pre><span></span>    <span class="p">{</span> <span class="err">&#39;containerID&#39;:</span> <span class="err">&#39;C02&#39;,</span>
    <span class="err">&#39;simulation&#39;:</span> <span class="err">&#39;co2sensor&#39;,</span>
    <span class="err">&#39;nb_of_records&#39;:</span> <span class="err">1000,</span>
    <span class="nt">&quot;product_id&quot;</span><span class="p">:</span>  <span class="s2">&quot;P02&quot;</span>
    <span class="p">}</span>
</pre></div>

<p>We have tried to support a domain driven design approach to structure the code, with domain, infrastructure and app modules. The domain module has a unique class for the simulator which main goals is to generate tuples or records for the different simulation types. It is reused for the standalone simulation tools to generate data at rest.</p>
<p>As the simulator is also a webapp we need to package it with <a href="https://www.fullstackpython.com/flask.html">Flask</a> and run it using one of the Web Server Gateway Interface (WSGI) implementation with <a href="http://docs.gunicorn.org/">Gunicorn</a>.</p>
<p>We recommend to follow <a href="https://flask.palletsprojects.com/en/1.1.x/tutorial/">Flask tutorial</a> if you do not know this python library to develop web app or REST service.</p>
<p>Flask is a simple library to implement REST based microservice and web application in python. It has other related projects to add interesting features to develop production application. The standard development includes defining routes, function to support handling the request and generating HTTP response, but also defining APIs... Read more with the <a href="http://exploreflask.com/en/latest/">explore Flask book online</a>.
Flask is mono threaded so it fits well in a simple web application for development purpose, but for production it is recommended to add a web server like <a href="https://gunicorn.org/">Gunicorn</a> to handle multiple concurrent requests.</p>
<h2 id="code-approach">Code approach</h2>
<p>The application is built using <a href="https://appsody.dev">Appsody</a> as the developer experience tooling. The <a href="https://appsody.dev/docs/getting-started/installation">Appsody CLI</a> is required locally to build and deploy the application properly.</p>
<p>The app is done using Flask, and the code is generated using <code>appsody init python-flask</code> command with the Python Flask appsody stack and template.</p>
<p><img alt="Appsody components" src="../images/appsody-concept.png" /></p>
<p>Appsody helps developer to do not worry about the details of k8s deployment and build. During a Appsody run, debug or test step (2), Appsody creates a Docker container based on the parent stack Dockerfile, and combines application code with the source code in the template.</p>
<p>We recommend reading <a href="https://github.com/appsody/stacks/tree/master/incubator/python-flask">the Python Flask Appsody Stack git hub repo</a> to get familiar with appsody python stack.</p>
<p>This stack is defining the Flask application, and import the 'userapp' where the application code resides, then use blueprints to define health and metrics APIs:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">userapp</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">server.routes.health</span> <span class="kn">import</span> <span class="n">health_bp</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">health_bp</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">server.routes.prometheus</span> <span class="kn">import</span> <span class="n">metrics_bp</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">metrics_bp</span><span class="p">)</span>
</pre></div>

<p>This code is not updatable as it is part of the image. But we can add our business logic as part of the <code>simulator/__init__.py</code> code using another <a href="https://flask.palletsprojects.com/en/1.1.x/blueprints/">Flask blueprints</a> module <a href="">api/controller.py</a>.</p>
<p>The <code>userapp</code> module is defined when appsody integrates our code with the stack base image using Docker. Below is an extract of the docker file managing module installation and defining what appsody does during build, run and test:</p>
<div class="codehilite"><pre><span></span>ENV APPSODY_MOUNTS=/:/project/userapp
ENV APPSODY_DEPS=/project/deps
WORKDIR /project
RUN python -m pip install -r requirements.txt -t /project/deps
ENV FLASK_APP=server/__init__.py
</pre></div>

<p>Looking at the content of the final docker container running the application we can see this structure:
<div class="codehilite"><pre><span></span>/project
|-- Dockerfile
    Pipfile
    Pipfile.lock
    constraints.txt
    requirements.txt
    deps/
    server/
    test/
    userapp/
</pre></div></p>
<p>The basic concept of blueprints is that they record operations to execute when registered on an application. So to add the operation to support the control we add a blueprint, and then register it in the main application: <code>__init__py</code>.</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">userapp.api.controller</span> <span class="kn">import</span> <span class="n">control_blueprint</span>
<span class="n">app</span><span class="o">.</span><span class="n">register_blueprint</span><span class="p">(</span><span class="n">control_blueprint</span><span class="p">)</span>
</pre></div>

<p>To define the API, we use <a href="https://github.com/flasgger/flasgger">Flasgger</a> as an extension to Flask to extract <a href="https://swagger.io/docs/specification/about/">Open API specification</a> from the code. It comes with Swagger UI, so we can see the API documentation of the microservice at the URL <code>/apidocs</code>.  It can also validate the data according to the schema defined.</p>
<p>For the POST /control we define the using Swagger 2.0 the API in a separate file: <code>api/controlapi.yml</code> and import it at the method level to support the POSt operation. This method is defined in its blueprint as a REST resource. The code <a href="https://github.com/ibm-cloud-architecture/refarch-reefer-ml/blob/master/simulator/api/controller.py">controller.py</a> is under <code>api</code> folder.</p>
<p>Below is a code extract to illustrate the use of Flask-RESTful and blueprint and the swagger annotation:</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">flasgger</span> <span class="kn">import</span> <span class="n">swag_from</span>
<span class="kn">from</span> <span class="nn">flask_restful</span> <span class="kn">import</span> <span class="n">Resource</span><span class="p">,</span> <span class="n">Api</span>

<span class="n">control_blueprint</span> <span class="o">=</span> <span class="n">Blueprint</span><span class="p">(</span><span class="s2">&quot;control&quot;</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">)</span>
<span class="n">api</span> <span class="o">=</span> <span class="n">Api</span><span class="p">(</span><span class="n">control_blueprint</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">SimulationController</span><span class="p">(</span><span class="n">Resource</span><span class="p">):</span>
    <span class="nd">@swag_from</span><span class="p">(</span><span class="s1">&#39;controlapi.yml&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ..</span>
<span class="n">api</span><span class="o">.</span><span class="n">add_resource</span><span class="p">(</span><span class="n">SimulationController</span><span class="p">,</span> <span class="s2">&quot;/control&quot;</span><span class="p">)</span>
</pre></div>

<p>The <a href="https://github.com/ibm-cloud-architecture/refarch-reefer-ml/blob/master/simulator/Pipfile">Pipfile</a> defines the dependencies for this component, and is used by <code>pipenv</code> during the automatic build process within <code>appsody build</code>.</p>
<p>To launch the web application in development mode, using an IBM Event Streams remote use the following commands:</p>
<div class="codehilite"><pre><span></span><span class="c1"># set environment variables - from simulator folder</span>
$ <span class="nb">source</span> ../scripts/setenv.sh OCP
<span class="c1"># Start appsody with the environment variables: in simulator folder</span>
$ appsody run --docker-options<span class="o">=</span><span class="s2">&quot;-e KAFKA_BROKERS=</span><span class="nv">$KAFKA_BROKERS</span><span class="s2"> -e KAFKA_APIKEY=</span><span class="nv">$KAFKA_APIKEY</span><span class="s2"> -e KAFKA_CERT=</span><span class="nv">$KAFKA_CERT</span><span class="s2"> -e TELEMETRY_TOPIC=</span><span class="nv">$TELEMETRY_TOPIC</span><span class="s2"> -e CONTAINER_TOPIC=</span><span class="nv">$CONTAINER_TOPIC</span><span class="s2">&quot;</span>
</pre></div>

<p>The trace shows the Kafka configuration options:</p>
<div class="codehilite"><pre><span></span>Kafka options are:
[Container] {&#39;bootstrap.servers&#39;: &#39;eventstream140-ibm-es-proxy-route-broker-0-eventstreams.apps.green.ocp.csplab.local:443&#39;, &#39;group.id&#39;: &#39;ReeferTelemetryProducers&#39;, &#39;security.protocol&#39;: &#39;SASL_SSL&#39;, &#39;sasl.mechanisms&#39;: &#39;PLAIN&#39;, &#39;sasl.username&#39;: &#39;token&#39;, &#39;sasl.password&#39;: &#39;xCByo4478xQH...EVdcbGNCtLLuItKgVDc&#39;, &#39;ssl.ca.location&#39;: &#39;/project/userapp/certs/ocp/es-cert.pem&#39;}
</pre></div>

<h2 id="testing">Testing</h2>
<h3 id="unit-test-the-simulator">Unit test the Simulator</h3>
<p>The test coverage is not yet great. To run the test use <code>appsody test</code>.</p>
<div class="codehilite"><pre><span></span><span class="n">cd</span> <span class="n">simulator</span>
<span class="p">.</span><span class="o">/</span><span class="n">startPythonEnv</span>
<span class="n">root</span><span class="mi">@1</span><span class="nl">de81b16f940</span><span class="p">:</span><span class="o">/</span><span class="err">#</span> <span class="n">export</span> <span class="n">PYTHONPATH</span><span class="o">=/</span><span class="n">home</span><span class="o">/</span><span class="n">simulator</span>
<span class="n">root</span><span class="mi">@1</span><span class="nl">de81b16f940</span><span class="p">:</span><span class="o">/</span><span class="err">#</span> <span class="n">cd</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">simulator</span>
<span class="n">root</span><span class="mi">@1</span><span class="nl">de81b16f940</span><span class="p">:</span><span class="o">/</span><span class="err">#</span> <span class="n">python</span> <span class="n">tests</span><span class="o">/</span><span class="n">unit</span><span class="o">/</span><span class="n">TestSimulator</span><span class="p">.</span><span class="n">py</span>
</pre></div>

<h3 id="functional-testing">Functional testing</h3>
<h2 id="prepare-for-kubernetes-deployment">Prepare for kubernetes deployment</h2>
<ol>
<li>
<p>There are three required configuration elements for connectivity to IBM Event Streams (Kafka) prior to deployment as we already presented in the following notes.</p>
</li>
<li>
<p>A <code>ConfigMap</code> named <code>kafka-brokers</code> <strong><a href="https://ibm-cloud-architecture.github.io/refarch-kc/deployments/backing-services/#event-streams-kafka-brokers_1">Reference Link</a></strong></p>
</li>
<li>A <code>Secret</code> named <code>eventstreams-api-key</code> <strong><a href="https://ibm-cloud-architecture.github.io/refarch-kc/deployments/backing-services/#event-streams-api-key_1">Reference Link</a></strong></li>
<li>
<p>A <code>Secret</code> named <code>eventstreams-cert-pem</code> <em>(if connecting to an on-premise version of IBM Event Streams)</em> <strong><a href="https://ibm-cloud-architecture.github.io/refarch-kc/deployments/backing-services/#event-streams-certificates">Reference Link</a></strong></p>
</li>
<li>
<p>Once those elements are defined it is important to configure the app so it can retrieve those information via environment variables. With Appsody the file <code>appsody-config.yaml</code> is supporting these configurations. See the <a href="https://github.com/ibm-cloud-architecture/refarch-reefer-ml/blob/master/simulator/app-deploy.yaml#L24-L40">lines 24 to 40</a> to get the settings to map environment variables to Config Maps or Secrets.</p>
</li>
</ol>
<p>When using TLS connection, the TLS certificate is mounted inside the container via mounted file system. Inside the container the directory will be <code>/certs</code> and the volume is in fact a Secret containing the pem certificate as string.</p>
<div class="codehilite"><pre><span></span><span class="nt">volumeMounts</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">mountPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/certs</span>
    <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">eventstreams-cert-pem</span>
  <span class="nt">volumes</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">eventstreams-cert-pem</span>
    <span class="nt">secret</span><span class="p">:</span>
      <span class="nt">optional</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="nt">secretName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">eventstreams-cert-pem</span>
</pre></div>

<h2 id="build">Build</h2>
<p>The Docker image can be built from this directory by using the <code>appsody build</code> command:</p>
<ol>
<li>Ensure you are logged in to the desired remote Docker registry through your local Docker client.</li>
<li>The <code>appsody build -t ibmcase/kcontainer-reefer-simulator:appsody-v1 --push</code> command will build and push the application's Docker image to the specified remote image registry (here this is the public docker hub repository).</li>
</ol>
<h2 id="application-deployment">Application deployment</h2>
<p>The application can be deployed to a remote OpenShift cluster by using the <code>appsody deploy</code> command (We recommend reading <a href="https://appsody.dev/docs/using-appsody/building-and-deploying/">Appsody build and deploy product documentation</a>):</p>
<ul>
<li>Deploy using the docker image on public docker hub repository:</li>
</ul>
<div class="codehilite"><pre><span></span><span class="c1"># login to the openshift cluster if not done already</span>
oc login --token<span class="o">=</span>rR.... --server<span class="o">=</span>https://api.green.ocp.csplab.local:6443
<span class="c1"># Deploy to the eda-sandbox project</span>
appsody deploy -t ibmcase/kcontainer-reefer-simulator:appsody-v1 --namespace eda-sandbox --no-build
</pre></div>

<p>You can verify the deployment with the CLI
<div class="codehilite"><pre><span></span>oc get pods
</pre></div></p>
<p>or the via the Openshift console:</p>
<p><img alt="" src="../images/simul-app-ocp.png" /></p>
<ul>
<li>To make the webapp visible externally to the cluster, you need to add a <code>route</code> for this deployment. Login to the admin console and use <code>Create Route</code> button on top right of the screen,</li>
</ul>
<p><img alt="" src="../images/create-routes.png" /></p>
<p>Then enter a name and select the existing service</p>
<p><img alt="" src="../images/simul-route-create.png" /></p>
<p>Once created, the URL of the app is visible in the route list panel:</p>
<p><img alt="" src="../images/simul-route.png" /></p>
<p>Add the host name in your local /etc/hosts or be sure the hostname is defined in DNS server. Map to the IP address of the kubernetes proxy server end point.</p>
<h3 id="continuous-deployment-with-tekton">Continuous deployment with Tekton</h3>
<p>The general approach to use Tekton to deploy the components of the solution is defined in <a href="../../devops/cd/#tekton-appsody-deployments">this note</a>.</p>
<h2 id="usage">Usage</h2>
<p>Once deployed, you can access the Swagger-based REST API via the defined route and trigger the simulation controls.</p>
<ol>
<li>To determine the route, use the <code>oc get route reefer-simulator</code> command and go to the URL specified in the <code>HOST/PORT</code> field in your browser.</li>
<li>From there, drill down into the <code>POST /control</code> section and click <strong>Try it out!</strong>.</li>
<li>
<p>Enter any of the following options for the fields prepopulated in the <code>control</code> body:</p>
<ul>
<li>Container: <code>C01, C02, C03, C04</code></li>
<li>Product: <code>P01, P02, P03, P04</code></li>
<li>Simulation: <code>poweroff, co2sensor, o2sensor, normal</code></li>
<li>Number of records: A positive integer</li>
</ul>
</li>
<li>
<p>Click <strong>Execute</strong></p>
</li>
</ol>
<h3 id="to-generate-data-at-rest">To generate data at rest</h3>
<p>The same simulator can be run as a standalone tool to create csv files or to write to a remote mongoDB database. The explanation on how to use this tool is done in a <a href="../../collect/generate-telemetry/">separate note here</a>.</p>
<h2 id="more-readings">More readings</h2>
<ul>
<li><a href="https://flask-restful.readthedocs.io/en/latest/quickstart.html">Flask Restful</a></li>
<li><a href="https://appsody.dev/docs/using-appsody/building-and-deploying/">Appsody build and deploy product documentation</a></li>
</ul>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../bpm/readme/" title="Engineer dispatching with Business process with Cloud Pak for Automation" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Engineer dispatching with Business process with Cloud Pak for Automation
              </span>
            </div>
          </a>
        
        
          <a href="../dev-scoring/" title="Develop the scoring app with event messaging and microprofile" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Develop the scoring app with event messaging and microprofile
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.b806dc00.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>